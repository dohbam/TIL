### 블록체인

> 비트코인 == 블록체인은 아니다. 모든 암호화 화폐가 동작하는 기술의 핵심이 블록체인.

#### 1. 블록체인의 시작

* 비트코인: 블록체인의 등장
  * 전자 화폐
    * 곡식: 1만년 전부터 사용된 화폐의 원형
    * 금: 약 5천 년 전 등장하여 상당 기간 화폐로 사용
    * 종이 화폐: 약 1000년 전 중국에서 처음 사용
    * 오랜 기간 동안 금과 은에 본위를 두는 화폐를 사용
    * 인터넷 기술이 발전하며 전자 화폐 등장
    * 2009년 비트코인이라는 암호화폐가 등장
* 비트코인과 실물화폐의 차이
  * 비트코인은 탈중앙화된 화폐
    * 실물화폐는 중앙 기관에서 발행하고 금융 기관에서 관리
    * 비트코인은 별도의 발행 기관과 관리 기관이 없음
* 탈중앙화의 기여점
  * 탈중앙화는 많은 지불 결제의 중개에 드는 비용을 줄일 수 있음
    * 금융 기관 없이도 송금 가능
* 블록체인의 역사 : 사이퍼 펑크 운동
  * 사이퍼 펑크 운동 : 암호화 기술을 이용하여 변화를 꾀하는 운동
  * 1983 D.Chaum
    * 프라이버시를 지키기 위한 전자 화폐 시스템이 필요하다.
  * 계속 이어져온 흐름
  * 2008 S. Nakamoto라는 익명의 유저가 비트코인 백서 공개
    * 블록체인이라는 말은 어디에도 나와있지 않지만, 그 원리와 증명 등은 잘 나와있음
    * 블록체인을 공부하려면 읽어야 하는 바이블
  * 2009 100만 비트코인 채굴
  * 2015 이더리움, R3, 하이퍼렛저 등장
* 비트코인의 거래
  * 비트코인은 탈중앙화된 장부로 이루어짐
    * 참여자가 모든 사람의 거래 내역을 저장함: 분산화
    * 참여자가 합의하여 거래를 결정: 분권화

#### 2. 블록체인과 P2P 네트워크

* Peer-to-peer 네트워크
  * 블록체인은 P2P 네트워크를 통해 거래를 저장
    * 클라이언트/서버는 계층을 두고 데이터를 전송
    * P2P는 동등 계층간 데이터를 전송하는 기법
    * 피어들은 서버와 클라이언트 역할을 동시에 함
    * 데이터의 무결성이 지켜짐
  * 블록체인은 비구조화 오버레이를 따름
* 특징 1. 블록체인의 불가역성
  * 한 버 기록/승인된 데이터는 수정과 삭제가 불가능하여야 한다.

#### 3. 블록체인과 디지털 서명

* 블록체인의 부인방지
  * 다른 사람이 자신의 돈을 보낼 수 없어야 함
  * 내가 보냈다는 사실을 추후에 부인할 수 없어야 함

* 비트코인의 "지갑"
  * 개인키: 256비트 무작위 숫자, k
  * 공개키: k * G(생성 포인트), 개인키 추론 불가, K
  * 비트코인 주소 생성: Base 58(), A
  * 공개키 기반 구조(PKI)
  * 개인키/공개키가 비대칭 키로서 활용됨
* 공개키 기반 구조의 활용
  * 받는 사람의 공개키로 암호화 : 보낸 사람의 개인키를 가진 사람만 암호화 해제 가능
  * 보내는 사람의 개인키로 암호화 : 보낸 사람의 공개키를 아는 모든 사람이 암호화 해제 가능
  * 블록체인에서는 후자를 사용. 개인키 암호화 방식. 거래 내역 보장이 가능하기 때문.
  * 보안적으로 취약하여 이슈가 많음.
  * 개인키를 관리해주던 거래소가 털려서...
  * 물리적으로 지갑을 만들어놓기도 했고 요즘에는 콜드월렛과 하드웨어 월렛이 유행. USB 활용.
* 블록체인에서의 디지털 서명
  * 보낸 사람의 개인키로 암호화한 거래 내역이 디지털 서명. 보낸 사람의 공개키로 해독이 가능하므로 모두가 알 수 있음. 세 개를 다 보내기도 함. 거래 내역, 디지털 서명, 공개키.

* 특징 2. 데이터 출처 검증 : 데이터 저장 시 데이터의 출처를 기록하여야 한다.

> NIST(미국 표준 기관)의 블록체인 자료를 보시면 도움이 될 것.

#### 4. 블록 생성과 작업 증명

> 블록: 일정 시간동안 발생한 모든 비트코인 거래들의 집합.
>
> 이 블록을 어떻게 이용하고 어떻게 체인의 형태로 연결할 것인지, 작업증명을 어떻게 하는지 설명할 예정.

* 블록체인과 블록
  * 데이터를 기록하는 기본 단위
  * 거래장부에 블록이 기록 - 블록에 거래내역이 기록
  * 비트코인은 약 10분 간의 거래 내역을 하나의 블록으로 저장
  * 이더리움은 14~15초에 하나씩
  * 공개형이 아닌 허가형 또는 사설은 초당으로 하기도. 다양함.
* 해시 알고리즘
  * 주로 원본 값의 위변조 여부를 확인하는 데 활용
  * 출력값으로 입력값을 유추할 수 없음
  * 비트코인은 SHA-256 사용. 입력값에 따른 유일한 출력값 256비트.
  * 입력값이 조금만 달라져도 완전히 다른 출력값이 나오기 때문에 위조 판별 가능.
  * 다른 가상화폐에서는 또 다른 알고리즘 사용.
* 블록의 구성
  * 헤더(block header)
    * 이전 블록의 해시코드(체인 역할)
    * 트랜잭션의 해시코드(이진 트리 구조의 알고리즘으로 생성한 값. 모든 트랜잭션에 대한 요약값)
    * 블록 생성 시간
    * 문제 난이도
    * 문제 정답
  * 거래내역(Transactions, block body)
    * 비트코인은 평균 2천 개 수준
* 트랜잭션의 해시 저장 : 머클트리
  * 이진트리 구조. 모든 트랜잭션을 두개씩 짝지어 해시 알고리즘을 돌림. 그렇게 타고 올라감.
  * 최종값이 머클트리의 루트값, 머클 루트 (트랜잭션의 해시코드라고 쓴 부분)
  * 트랜잭션 하나라도 위변조하면 최종값이 달라지므로 위변조 탐지 가능
  * 비트코인에서 쓰이는 방식. 다른 블록체인은 또 다른 알고리즘, 자료구조 사용. 

* 특징 3. 모두가 검증 가능한 데이터 저장소 : 참여자 모두가 데이터 무결성을 확인할 수 있어야 한다.
* 작업 증명 (Proof of Work)
  * 문제 정답을 블록에 넣어야 블록 생성, 비트코인 채굴. 먼저 찾는 이에게 보상(비트코인 발행)
* 난이도 조절
  * 매 2016 블록(약 2주)마다 난이도 재계산(10분에 하나 정도 채굴되도록)
* 비트코인과 보상
  * 채굴은 2,100만 개가 한계. 그 이후론 채굴 인센티브가... 없다고?
* 작업증명의 한계
  * 채굴장에서 전문적으로 채굴만 하는 사람들
* 이중 지불 사례
  * 지불이 완전히 승인이 나기 전에 다른 지불을 진행하는 것
  * 비트코인은 승인에 시간이 걸리기 때문에 이중 지불이 가능
* 6승인과 포크
  * 포크: 이중 지불을 하면 블록의 분기 발생
    * 동일한 idx로 거래를 두 번 하여 분기 발생
  * 6승인: 블록의 완전 승인은 6개의 블록이 더 생성되어야 함
  * 포크 시 블록 승인: 먼저 6승인을 성공한 블록이 완전 승인
  * 일반 노드들은 승인 확률이 높은 블록을 기반으로 블록을 생성
  * 따라서 길이가 길거나 블록 시간이 빠른 쪽에 먼저 블록 만듦
  * 승인 안 난 거래는 다시 채굴 대기
* 51% 공격
  * 이중 지불의 성공을 위해서는 전체 해시 파워의 51% 이상을 한 시간 동안 장악해야 함
    * 작업증명을 누구보다 빨리 해야 한다는 의미
  * 현실적으로 매우 어려움
* 합의의 의미
  * 합의를 통해 모든 장부를 동기화
* 특징 4. 합의된 데이터 저장 : 모든 참여자가 합의를 이룬 데이터를 저장하여야 한다.

#### 5. 정리

* 특징들 : 블록체인 데이터가 신뢰받는 이유

#### 6. 스마트 컨트랙트의 개요

* 이더리움의 등장
  * 21살의 천재 프로그래머가 만들었음
  * 이더리움 서비스를 통해 네트워크 상에서 스마트 컨트랙트를 가능하게 함
* 스마트 컨트랙트의 기원
  * 특정 계약을 스스로 수립, 검증, 이행하기 위한 컴퓨터 프로토콜
  * 계약 보안을 높이고 비용을 감소하기 위한 방안
  * 1994 Nick Szabo가 처음으로 smart contract 라는 단어 사용
  * 악의와 사고적 예외 최소화, 중개자 최소화, 사기 손실 최소화, 중재 손실 낮추고, 강제적 실행
  * 이더리움 등장 전까지는 거의 사장된 개념이었음
* 블록체인과 스마트 컨트랙트
  * 블록체인에 스마트 컨트랙트 데이터를 기록
    * 계약 기록, 내용, 코드, 이행 이력과 결과
* 프로그래머블 머니
  * 검증된 프로그램에 따라 지불되는 돈
* 블록체인 2.0
  * 이더리움 이후 스마트 컨트랙트 개념을 가지고 개발된 블록체인들
* 스마트 컨트랙트 활용 사례
  * 토큰 서비스
  * 에스크로 서비스
* 이더리움 가상 머신
* 스마트 컨트랙트 배포 및 실행
  * 스마트 계약 생성 과정
    * 스마트 계약 코드 (컴파일) 바이트 코드 (트랜잭션 생성) 블록체인 블록 (배포) 블록체인 네트워크
  * 스마트 계약 실행 과정
    * 사용자 주소 + 함수 주소 + 매개 변수 (트랜잭션 생성) 블록체인 블록 (실행) 블록체인 네트워크
  * 프로그램도 배포하고 다양한 서비스도 실행할 수 있다.
* 튜링 완전성과 가스
  * 스마트 계약을 실행하기 위한 수수료 : 가스 가격 x 사용 가스 수
  * 가스 가격 : Gwei 단위(1Gwei = 0.000000001)
  * 단위 가스 가격은 사용자가 정의할 수 있으나, 많을수록 빠른 처리 가능
  * 모든 계약에 가스 제한(Gas Limit) 설정 가능
  * 호출하는 함수의 종류에 따라 비용 차등 부여
    * 함수 생성: 32000gas
    * 거래: 21000gas

#### 6. 기업형 블록체인 ... 사례

* R3CEV의 탄생
  * 은행들이 만든 블록체인 컨소시움이었음
  * 2018년 4월 Corda 발표
* 공개형 블록체인의 한계
  * 프라이버시
  * 트랜잭션 최종성
  * 식별 가능한 참여자
  * 확장성
  * 생산성과 통합
* 허가형 블록체인 등장 (Permissioned)
* 하이퍼렛저의 프로젝트들
* 패브릭 적용 사례 : 월마트, ...
* 기업형 블록체인의 활용 가능 사업 분야 : 매우 다양
  * 은행, 공급망, 정치, 금융시장, 의료, 보험, 소매, 생산 등
  * 정부 주도 사업은 거의 다 패브릭 사용중

#### 7. 프로젝트

* 1주차: 블록체인 기초 역량 습득
  * 대표 퍼블릭/프라이빗 블록체인 오픈 소스에 대한 이해와 경험
    * 이더리움 및 파이퍼레저 패브릭 네트워크 구축
    * 프론트엔드와 이더리움 간 연동
    * 이더리움 스마트 컨트랙트 개발
    * 하이퍼레저 패브릭 체인코드 개발
  * 2주차부터 진행할 P2P 경매 서비스 구현을 위한 기반 지식 습득
  * Part1: 이더리움
    * 이더리움 네트워크 구축
    * 이더리움 익스플로러 구현
    * 스마트 컨트랙트 작성 및 배포
  * Part2 : 하이퍼레저 패브릭
    * 패브릭 네트워크 구축
    * 체인코드 작성 배포 및 사용
* 2주차: 블록체인 기반 P2P 경매 시스템
  * UI, 로그인 기능 기본 제공.
* 시스템 특징
  * 이더리움과 패브릭의 특성에 따른 일반적 적용 사례가 반영된 시스템
    * 이더리움
      * 이더리움의 화폐인 이더를 재화로 사용
      * 이더리움 DApp(분산앱, Decentralised Application) 형태의 경매 가능
    * 패브릭
      * 이해 관계자의 컨소시엄으로 허가형 네트워크를 구성
      * 구성된 네트워크의 채널을 통해 자산을 관리
      * 암호화폐보다는 이력 관리에 사용
  * 모든 기술 스택을 경험해볼 수 있을 것...
  * 과제 1: 지갑 - 이더리움
  * 과제 2: 작품 소유권 등록 기능 - 패브릭
  * 과제3: 작품 소유권 관련 기능 - 소유권 이전 및 소멸 함수 추가하여 체인코드 작성, 재배포
  * 과제4: 경매 관련 기능 - 경매 스마트 컨트랙트...
  * 과제5: 소유권 관련 기능













Q. 프라이버시는 어떻게 지켜지는지?

A. 계좌와 사람이 연결되지 않음. 익명성 보장.

Q. 한 사람이 계좌 여러 개를 만들어서 거래를 조작하거나 할 수는 없는지.

A. 가능함. 제재도 없음. (주호- 실제 사례도 저번 달에 있었음. 중국에서 갑자기 8% 낮은 가격으로 물량이 확 나와서 시세가 떨어짐. 개미들 털려고 올리자마자 한 사람이 쓸어감. 가격이 치솟으니까 다시 사려고 한 순간 그걸 확 털어버린 거야. 30% 차익을 올림. 그걸 제재도 못해. 그리고 트랜지션 수수료 안 내면 실시간 거래도 안되는데 거래소 거치면 트랜지션 안 내도 실시간 거래도 된다? 그럼 내 비트코인이 진짜가 맞는가도 의심해야 하는 상황인 거지.)



뭔소린지 모르겠어.......



* 20190621 추가활동 (문제 만들기)
  * Ethereum은 블록체인 기술을 기반으로 스마트 계약(Smart Contract)을 구현하기 위한 분산 컴퓨팅 플랫폼이다. 이더리움이 제공하는 Ether는 비트코인과 마찬가지로 암호화폐의 일종으로 거래되고 있다. 화폐 단위는 ETH로 표시한다. 
    빈 칸에 들어갈 말로, 특정 계약을 스스로 수립, 검증, 이행하기 위한 컴퓨터 프로토콜을 의미하는 것은?
    * 답) 스마트 계약, Smart Contract
    * 출제 키워드: Ethereum
    * 참고 데이터: 20일 블록체인 강의, [링크]([https://ko.wikipedia.org/wiki/%EC%9D%B4%EB%8D%94%EB%A6%AC%EC%9B%80](https://ko.wikipedia.org/wiki/이더리움))
  * 비트코인에서 트랜잭션의 해시를 저장하는 방법으로 이진트리 구조를 갖는 것은 무엇일까요? 해당 방법으로 위변조 탐지가 가능한 이유를 설명하세요.
    * 답) 머클 트리. 머클 트리는 이진트리 구조로 모든 트랜잭션을 두 개씩 짝지어 해시 알고리즘을 돌립니다. 최종값이 머클트리의 루트값, 머클 루트가 되는데 트랜잭션 하나라도 위변조하면 최종값이 달라지므로 위변조를 탐지할 수 있습니다.
    * 출제 키워드: Merkle Tree
    * 참고 데이터: 20일 블록체인 강의